<!DOCTYPE html>
<html lang = "en">
<head>
    <meta charset="utf-8" />

    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

    <!-- Optional theme -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">


    <title>PRISM Scripts Setup</title>

    <link rel="shortcut icon" type="image/png" href="img/BlueZoneScripts.png"/>
    <script>

    //This function creates strings containing the required content of redirect files
    function redirectFile(scriptToRedirectTo) {

        var filePath = document.getElementById("filepath").value;

        return "'LOADING GLOBAL VARIABLES--------------------------------------------------------------------"                                                                                  + "\n" +
            "Set run_another_script_fso = CreateObject(\"Scripting.FileSystemObject\")"                                                                                                         + "\n" +
            "Set fso_command = run_another_script_fso.OpenTextFile(\"" + filePath + "\\SETTINGS - GLOBAL VARIABLES.vbs\")"                                                                      + "\n" +
            "text_from_the_other_script = fso_command.ReadAll"                                                                                                                                  + "\n" +
            "fso_command.Close"                                                                                                                                                                 + "\n" +
            "Execute text_from_the_other_script"                                                                                                                                                + "\n" +
            ""                                                                                                                                                                                  + "\n" +
            "'LOADING SCRIPT"                                                                                                                                                                   + "\n" +
            "script_URL = script_repository & \"" + scriptToRedirectTo +  "\""                                                                                                                  + "\n" +
            "IF run_locally = False THEN"                                                                                                                                                       + "\n" +
            "   SET req = CreateObject(\"Msxml2.XMLHttp.6.0\")				'Creates an object to get a URL"                                                                                    + "\n" +
            "   req.open \"GET\", script_URL, FALSE							'Attempts to open the URL"                                                                                          + "\n" +
            "   req.send													'Sends request"                                                                                                     + "\n" +
            "   IF req.Status = 200 THEN									'200 means great success"                                                                                           + "\n" +
            "       Set fso = CreateObject(\"Scripting.FileSystemObject\")	'Creates an FSO"                                                                                                    + "\n" +
            "       Execute req.responseText								'Executes the script code"                                                                                          + "\n" +
            "   ELSE														'Error message, tells user to try to reach github.com, otherwise instructs to contact someone/stops script"         + "\n" +
            "       critical_error_msgbox = MsgBox (\"Something has gone wrong. The code stored on GitHub was not able to be reached.\" & vbNewLine & vbNewLine &_"                             + "\n" +
            "                                \"Script URL: \" & script_URL & vbNewLine & vbNewLine &_"                                                                                          + "\n" +
            "                                \"The script has stopped. Please check your Internet connection. Consult a scripts administrator with any questions.\", _"                         + "\n" +
            "                                vbOKonly + vbCritical, \"BlueZone Scripts Critical Error\")"                                                                                       + "\n" +
            "                                StopScript"                                                                                                                                        + "\n" +
            "   END IF"                                                                                                                                                                         + "\n" +
            "ELSE"                                                                                                                                                                              + "\n" +
            "   Set run_another_script_fso = CreateObject(\"Scripting.FileSystemObject\")"                                                                                                      + "\n" +
            "   Set fso_command = run_another_script_fso.OpenTextFile(script_URL)"                                                                                                              + "\n" +
            "   text_from_the_other_script = fso_command.ReadAll"                                                                                                                               + "\n" +
            "   fso_command.Close"                                                                                                                                                              + "\n" +
            "   Execute text_from_the_other_script"                                                                                                                                             + "\n" +
            "END IF"                                                                                                                                                                            + "\n";

    }

    //This actually sets up and creates the zip file, complete with redirects
    function scriptsSetupPRISM() {


        var filePath = document.getElementById("filepath").value;


        JSZipUtils.getBinaryContent('https://raw.githubusercontent.com/MN-Script-Team/DHS-PRISM-Scripts/master/Script%20Files/PAD%20-%20CS.pad', function(err, data) {
            if(err) {
                alert(err); //Provide a warning if there's an error
            } else {

                var zip = new JSZip();                                                      //Create a new JSZip object

                zip.file("Script Files/PAD - CS.pad",                                       data);                                                                      //Add the Power Pad which was grabbed using the .getBinaryContent function
                zip.file("Script Files/REDIRECT - ACTIONS.vbs",                             redirectFile("/ACTIONS/ACTIONS - MAIN MENU.vbs"));                          //Add each redirect needed for PRISM scripts
                zip.file("Script Files/REDIRECT - AGENCY CUSTOMIZED.vbs",                   redirectFile("/AGENCY CUSTOMIZED/SOURCE/AGENCY CUSTOMIZED.vbs"));
                zip.file("Script Files/REDIRECT - BULK.vbs",                                redirectFile("/BULK/BULK - MAIN MENU.vbs"));
                zip.file("Script Files/REDIRECT - NAV - CAAD.vbs",                          redirectFile("/NAV/NAV - CAAD.vbs"));
                zip.file("Script Files/REDIRECT - NAV - CAFS.vbs",                          redirectFile("/NAV/NAV - CAFS.vbs"));
                zip.file("Script Files/REDIRECT - NAV - CAPS.vbs",                          redirectFile("/NAV/NAV - CAPS.vbs"));
                zip.file("Script Files/REDIRECT - NAV - CAST.vbs",                          redirectFile("/NAV/NAV - CAST.vbs"));
                zip.file("Script Files/REDIRECT - NAV - CAWT.vbs",                          redirectFile("/NAV/NAV - CAWT.vbs"));
                zip.file("Script Files/REDIRECT - NAV - CPDD.vbs",                          redirectFile("/NAV/NAV - CPDD.vbs"));
                zip.file("Script Files/REDIRECT - NAV - ENFL.vbs",                          redirectFile("/NAV/NAV - ENFL.vbs"));
                zip.file("Script Files/REDIRECT - NAV - FIND THAT SCREEN IN PRISM.vbs",     redirectFile("/NAV/NAV - FIND THAT SCREEN IN PRISM.vbs"));
                zip.file("Script Files/REDIRECT - NAV - MAXIS SCREEN FINDER.vbs",           redirectFile("/NAV/NAV - MAXIS SCREEN FINDER.vbs"));
                zip.file("Script Files/REDIRECT - NAV - NCDD.vbs",                          redirectFile("/NAV/NAV - NCDD.vbs"));
                zip.file("Script Files/REDIRECT - NAV - NCID.vbs",                          redirectFile("/NAV/NAV - NCID.vbs"));
                zip.file("Script Files/REDIRECT - NAV - PALC.vbs",                          redirectFile("/NAV/NAV - PALC.vbs"));
                zip.file("Script Files/REDIRECT - NAV - PAPL.vbs",                          redirectFile("/NAV/NAV - PAPL.vbs"));
                zip.file("Script Files/REDIRECT - NAV - PESE.vbs",                          redirectFile("/NAV/NAV - PESE.vbs"));
                zip.file("Script Files/REDIRECT - NAV - SUCW.vbs",                          redirectFile("/NAV/NAV - SUCW.vbs"));
                zip.file("Script Files/REDIRECT - NAV - USWD.vbs",                          redirectFile("/NAV/NAV - USWD.vbs"));
                zip.file("Script Files/REDIRECT - NOTES.vbs",                               redirectFile("/NOTES/NOTES - MAIN MENU.vbs"));
                zip.file("Script Files/REDIRECT - NOTES - QUICK CAAD.vbs",                  redirectFile("/NOTES/NOTES - QUICK CAAD.vbs"));
                zip.file("Script Files/REDIRECT - UTILITIES.vbs",                           redirectFile("/UTILITIES/UTILITIES - MAIN MENU.vbs"));
                zip.file("Script Files/REDIRECT - UTILITIES - EMAIL SCRIPTS SUPPORT.vbs",   redirectFile("/UTILITIES/UTILITIES - EMAIL SCRIPTS SUPPORT.vbs"));
                zip.file("README.txt",                                                      "This is your BlueZone Scripts directory\n");        //README

                //NOW WE NEED TO CREATE A GLOABL VARIABLES FILE!
                var globVarContent =
                    "'COUNTY CUSTOM VARIABLES----------------------------------------------------------------------------------------------------" +
                    "\n" + "'The following variables are dynamically added via the installer. They can be modified manually to make changes without re-running the installer, but doing so should not be undertaken lightly." +
                    "\n" +
                    "\n" + "' DETAILS ABOUT HOW YOUR SCRIPTS WILL RUN ----------------------------------------------------------------------------------" +
                    "\n" +
                    "\n" + "'Run locally: if this is set to \"True\", the scripts will run locally and bypass GitHub entirely. This is great for debugging or developing scripts. Only scriptwriters should do it. An agency should always be set to \"false\"." +
                    "\n" + "run_locally = false" +
                    "\n" +
                    "\n" + "'This is a variable which signifies the agency uses the master branch or the RELEASE branch. Set to true if you're a scriptwriter agency and all users are going to be on the master branch. Otherwise, set to false." +
                    "\n" + "use_master_branch = false" +
                    "\n" +
                    "\n" + "'This allows a \"beta user\" group to have access to master branch scripts, while everyone else uses release. This is helpful for counties that want to maintain a small test group." +
                    "\n" + "'Here is the list of agency super users. These users will have access to the test scripts. Enter the list of users' log-in IDs in the quotes below, comma separated" +
                    "\n" + "beta_users = \"\"" +
                    "\n" +
                    "\n" + "'This is used by the AGENCY CUSTOMIZED process, and can be used elsewhere if needed, but for now it's mostly informational" +
                    "\n" + "'	This is modified by the installer, which will determine if this is a scriptwriter or a production user." +
                    "\n" + "default_directory = \""+ filePath + "\"" +
                    "\n" +
                    "\n" + "'DETAILS ABOUT STATISTICS AND GATHERING THEM ------------------------------------------------------------------------------------------" +
                    "\n" +
                    "\n" + "'This is used for determining whether script_end_procedure will also log usage info in an Access table." +
                    "\n" + "collecting_statistics = False" +
                    "\n" +
                    "\n" + "'This is the file path for the statistics Access database." +
                    "\n" + "stats_database_path = \"C:\\DHS-PRISM-Scripts\\Databases for script usage\\usage statistics.accdb\"" +
                    "\n" +
                    "\n" + "'DETAILS ABOUT WHERE TO FIND DOCS AND WHICH TO USE ------------------------------------------------------------------------------------------" +
                    "\n" +
                    "\n" + "'This is the folder path for county-specific Word documents. Modify this with your shared-drive location for Word documents." +
                    "\n" + "word_documents_folder_path = \"C:\\DHS-PRISM-Scripts\\Word files for script usage\\\"" +
                    "\n" +
                    "\n" + "'DETAILS ABOUT THE COUNTY ITSELF -------------------------------------------------------------------------------------------------------------" +
                    "\n" +
                    "\n" + "'This is the county code on the CALI screen." +
                    "\n" + "county_cali_code = \"###\"" +
                    "\n" +
                    "\n" + "'An array of county attorneys. \"Select one:\" should ALWAYS be in there, and ALWAYS be first. Replace \"County Attorney #\" with your agency's county attorney names." +
                    "\n" + "county_attorney_array = array(\"County Attorney 1\", \"County Attorney 2\", \"County Attorney 3\", \"County Attorney 4\", \"County Attorney 5\")" +
                    "\n" +
                    "\n" + "'An array of child support magistrates. \"Select one:\" should ALWAYS be in there, and ALWAYS be first.  Replace \"Magistrate # with your agency's child support magistrate names." +
                    "\n" + "child_support_magistrates_array = array(\"Magistrate 1\", \"Magistrate 2\", \"Magistrate 3\", \"Magistrate 4\", \"Magistrate 5\")" +
                    "\n" +
                    "\n" + "'An array of judges. \"Select one:\" should ALWAYS be in there, and ALWAYS be first.  Replace \"Judge #\" with your agency's judges names." +
                    "\n" + "county_judge_array = array(\"Judge 1\", \"Judge 2\", \"Judge 3\", \"Judge 4\", \"Judge 5\")" +
                    "\n" +
                    "\n" + "'This is used by scripts which tell the worker where to find a doc to send to a client (ie \"Send form using Compass Pilot\")" +
                    "\n" + "EDMS_choice = \"Compass Pilot\"" +
                    "\n" +
                    "\n" + "'This is the county's email support address. It can be a distribution list or an individual." +
                    "\n" + "support_email_address = \"jean.valjean@paris.fr\"" +
                    "\n" +
                    "\n" + "'ACTIONS TAKEN BASED ON COUNTY CUSTOM VARIABLES------------------------------------------------------------------------------" +
                    "\n" + "'**DO NOT EDIT BELOW THIS LINE UNLESS YOU ARE ABSOLUTELY SURE OF WHAT YOU ARE DOING**" +
                    "\n" +
                    "\n" + "is_county_collecting_stats = collecting_statistics	'IT DOES THIS BECAUSE THE SETUP SCRIPT WILL OVERWRITE LINES BELOW WHICH DEPEND ON THIS, BY SEPARATING THE VARIABLES WE PREVENT ISSUES" +
                    "\n" +
                    "\n" + "'This loads the user ID for use in determining beta users. May also be used elsewhere in scripts." +
                    "\n" + "Set objNet = CreateObject(\"WScript.NetWork\")" +
                    "\n" + "windows_user_ID = objNet.UserName" +
                    "\n" +
                    "\n" + "'This will assign beta users to the master branch." +
                    "\n" + "If InStr(beta_users, UCASE(windows_user_ID)) <> 0 then use_master_branch = true" +
                    "\n" +
                    "\n" + "'This is the URL of our script repository, and should only change if the agency is a scriptwriting agency. Scriptwriters can elect to use the master branch, allowing them to test new tools, etc." +
                    "\n" + "IF use_master_branch = TRUE THEN		'scriptwriters typically use the master branch" +
                    "\n" + "    script_repository = \"https://raw.githubusercontent.com/MN-Script-Team/DHS-PRISM-Scripts/master/Script Files/\"" +
                    "\n" + "ELSE							'Everyone else (who isn't a scriptwriter) typically uses the release branch" +
                    "\n" + "    script_repository = \"https://raw.githubusercontent.com/MN-Script-Team/DHS-PRISM-Scripts/release/Script Files/\"" +
                    "\n" + "END IF" +
                    "\n" +
                    "\n" + "'If run locally is set to \"True\", the scripts will totally bypass GitHub and run locally." +
                    "\n" + "IF run_locally = TRUE THEN script_repository = \"C:\\DHS-PRISM-Scripts\\Script Files\\\"";

                zip.file("Script Files/SETTINGS - GLOBAL VARIABLES.vbs",                    globVarContent);

                //Save the zip file
                zip.generateAsync({type:"blob"})
                .then(function(content) {
                    saveAs(content, "PRISM scripts.zip");           // using FileSaver.js
                });

            }

        });


    }


</script>

</head>
<body>

    <div class="container">


    <nav class="navbar navbar-default">
      <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar-collapse-1" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="index.html">BlueZone Scripts Setup Utility</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-navbar-collapse-1">

          <ul class="nav navbar-nav navbar-right">
            <li><a href="howto.html">How to use this installer</a></li>
            <li><a href="MAXIS.html">MAXIS scripts</a></li>
            <li class="active"><a href="PRISM.html">PRISM scripts</a></li>

          </ul>
        </div><!-- /.navbar-collapse -->
      </div><!-- /.container-fluid -->
    </nav>


    <div class="panel-group" id="accordion">
      <div class="panel panel-default">
        <div class="panel-heading">
          <h4 class="panel-title">
            <a data-toggle="collapse" data-parent="#accordion" href="#collapse1">
            Step one: pick a place for your scripts to go</a>
          </h4>
        </div>
        <div id="collapse1" class="panel-collapse collapse in">
          <div class="panel-body">
              <p>
                  Your scripts need a place to go on your computer or shared drive. The file path you indicate here will be added to each script to ensure a proper connection all around.
              </p>
              <div class="form-group">
                  <label for="filepath">Enter your file path (ex: Z:\BlueZone Scripts\):</label>
                  <input type="text" class="form-control" id="filepath" placeholder="C:\DHS-PRISM-Scripts\Script Files\"/>
              </div>
          </div>
        </div>
      </div>
      <div class="panel panel-default">
        <div class="panel-heading">
          <h4 class="panel-title">
            <a data-toggle="collapse" data-parent="#accordion" href="#collapse2">
            Step two: tell us some details about your county</a>
          </h4>
        </div>
        <div id="collapse2" class="panel-collapse collapse">
          <div class="panel-body">Your county has attorneys, judges, and more. The information you select here will be added to pertinent scripts.</div>
        </div>
      </div>
      <div class="panel panel-default">
        <div class="panel-heading">
          <h4 class="panel-title">
            <a data-toggle="collapse" data-parent="#accordion" href="#collapse3">
            Step three: select where you'll keep script-related Word documents</a>
          </h4>
        </div>
        <div id="collapse3" class="panel-collapse collapse">
          <div class="panel-body">Scripts fill out some Word documents. You need to pick a place for these documents to go! Once the documents are added to your drive, you can feel free to modify the contents by adding anything your attorneys or management wants. Just make sure you leave the editable fields intact.</div>
        </div>
      </div>
      <div class="panel panel-default">
        <div class="panel-heading">
          <h4 class="panel-title">
            <a data-toggle="collapse" data-parent="#accordion" href="#collapse4">
            Step four: advanced (optional) options</a>
          </h4>
        </div>
        <div id="collapse4" class="panel-collapse collapse">
          <div class="panel-body">Some counties are collecting usage statistics or assigning "beta users" for testing purposes. If you don't know what any of that means, skip this part.</div>
        </div>
      </div>
    </div>


    <div class="col-xs-12 text-center">
        <p>
            <strong>You should be all set! This will create a *.zip file containing all of your scripts, redirects, and a Power Pad. Download the file and extract it to the directory specified in the first step. Good luck!</strong>
        </p>
        <button onclick="scriptsSetupPRISM()" class="btn btn-primary btn-sm" type="button">Download</button>
    </div>








    </div>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>

    <!-- Latest compiled and minified JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

    <!-- JSZip library -->
    <script src="js/jszip.min.js"></script>

    <script type="text/javascript" src="js/jszip-utils.js"></script>
    <!--
    Mandatory in IE 6, 7, 8 and 9.
    -->
    <!--[if IE]>
    <script type="text/javascript" src="js/jszip-utils-ie.js"></script>
    <![endif]-->

    <script src="js/FileSaver.min.js"></script>






</body>

</html>
